custom:
  AccountId: !Ref AWS::AccountId
  bundle:
    linting: true
    sourcemaps: false
    externals:
      - chokidar
  stage: ${opt:stage, self:provider.stage}
  prefix: ${self:service}-${self:custom.stage}
  myProfile:
    prod: hidefaces-prod
    dev: hidefaces-dev
  useDotenv: true
  ffmpegLayer:
    Fn::Join:
      - ":"
      - - "arn:aws:lambda:eu-west-1"
        - !Ref AWS::AccountId
        - "layer:ffmpeg:1"
  sharpLayer:
    Fn::Join:
      - ":"
      - - "arn:aws:lambda:eu-west-1"
        - !Ref AWS::AccountId
        - "layer:sharp:1"

lambdaPolicyDynamoDBMain:
  Effect: Allow
  Action:
    - dynamodb:Query
    - dynamodb:GetItem
    - dynamodb:PutItem
    - dynamodb:UpdateItem
    - dynamodb:DeleteItem
  Resource:
    - "Fn::GetAtt": [MainTable, Arn]

lambdaPolicyS3MainVideos:
  Effect: Allow
  Action:
    - S3:GetObject
    - S3:PutObject
    - S3:PutObjectAcl
    - S3:DeleteObject
  Resource:
    Fn::Join:
      - ""
      - - Fn::GetAtt: [MainBucket, Arn]
        - "/videos/*"

lambdaPolicyStateMachineVideo:
  Effect: "Allow"
  Action:
    - "states:StartExecution"
  Resource:
    - "Fn::GetAtt": [SMHideFacesOnVideo, Arn]

lambdaPolicySES:
  Effect: Allow
  Action:
    - ses:*
  Resource: "*"

lambdaPolicyXRay:
  Effect: Allow
  Action:
    - xray:PutTraceSegments
    - xray:PutTelemetryRecords
  Resource: "*"
